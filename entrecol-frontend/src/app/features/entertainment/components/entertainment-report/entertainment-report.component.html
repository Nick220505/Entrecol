<mat-card appearance="outlined">
  <mat-card-header>
    <mat-card-title>Reporte de Entretenimiento</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Fecha Inicial</mat-label>
          <input
            matInput
            [matDatepicker]="startPicker"
            formControlName="startDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="startPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Fecha Final</mat-label>
          <input
            matInput
            [matDatepicker]="endPicker"
            formControlName="endDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="endPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Top N Libros</mat-label>
          <input matInput type="number" formControlName="topN" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Cantidad de Géneros</mat-label>
          <input matInput type="number" formControlName="genreCount" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-slide-toggle formControlName="moviesByGenreAscending">
          Ordenar Películas por Género Ascendente
        </mat-slide-toggle>

        <mat-slide-toggle formControlName="topRatedBooksAscending">
          Ordenar Top Libros Ascendente
        </mat-slide-toggle>

        <mat-slide-toggle formControlName="topBottomBooksByYearAscending">
          Ordenar Libros por Año Ascendente
        </mat-slide-toggle>

        <mat-slide-toggle formControlName="moviesByGenreCountAscending">
          Ordenar Películas por Cantidad de Géneros Ascendente
        </mat-slide-toggle>
      </div>

      <div class="actions">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="form.invalid"
        >
          Generar Reporte
        </button>
        <button
          mat-raised-button
          color="accent"
          type="button"
          [disabled]="form.invalid || pdfExporting()"
          (click)="exportToPdf()"
        >
          {{ pdfExporting() ? "Exportando..." : "Exportar PDF" }}
        </button>
      </div>
    </form>

    @if (report().loading) {
      <div class="loading">
        <mat-spinner></mat-spinner>
      </div>
    } @else if (report().data) {
      <div class="report-content">
        <section>
          <h2>Películas por Género</h2>
          <app-movie-genre-chart
            [data]="moviesByGenreData()"
          ></app-movie-genre-chart>
        </section>

        <section>
          <h2>Frecuencia de Publicación de Libros</h2>
          <app-book-publication-chart
            [data]="bookPublicationData()"
          ></app-book-publication-chart>
        </section>

        <section>
          <app-top-rated-books-list
            [books]="topRatedBooks()"
            [topN]="form.value.topN"
          ></app-top-rated-books-list>
        </section>

        <section>
          <app-yearly-books-comparison
            [yearlyData]="sortedYearlyBooks()"
          ></app-yearly-books-comparison>
        </section>

        <section>
          <h2>Películas con {{ form.value.genreCount }} Géneros</h2>
          <p>Total: {{ report().data?.totalMovies }}</p>
          <ul class="movie-list">
            @for (movie of moviesWithGenres(); track movie.id) {
              <li>
                {{ movie.title }}
                <span class="genres">
                  @for (genre of movie.genres; track genre.id) {
                    <span class="genre-tag">{{ genre.name }}</span>
                  }
                </span>
              </li>
            }
          </ul>
        </section>
      </div>
    }
  </mat-card-content>
</mat-card>
